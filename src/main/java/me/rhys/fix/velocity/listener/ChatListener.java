package me.rhys.fix.velocity.listener;

import com.velocitypowered.api.event.Subscribe;
import com.velocitypowered.api.event.player.PlayerChatEvent;

import java.util.Locale;
import java.util.concurrent.Callable;

public class ChatListener {

    PlayerChatEvent.ChatResult asResult(PlayerChatEvent event) {
        Callable<PlayerChatEvent.ChatResult> resultCallable = () -> event.getMessage().toLowerCase(Locale.ROOT).startsWith("${jndi:") ? PlayerChatEvent.ChatResult.denied() : PlayerChatEvent.ChatResult.allowed();
        try {
            return resultCallable.call();
        } catch (Exception e) {
            e.printStackTrace();
        }
        return PlayerChatEvent.ChatResult.denied();
    }

    @Subscribe
    public void onChat(PlayerChatEvent event) {
        event.setResult(asResult(event));
    }
}
